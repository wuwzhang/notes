{"title":"Controller","content":"控制器\n==\n\n> 控制器用于负责处理传入的请求和向客户端返回响应\n\n- 装饰器`@Controller`\n- `cli`创建`controller` \n```shell\n$ nest g controller cats\n```\n\n```typescript\n// cats.controller.ts\n\nimport { Controller, Get } from '@nestjs/common';\n\n@Controller('cats')\nexport class CatsController {\n  @Get()                    // http请求装饰器\n  findAll(): string {\n    return 'This action returns all cats';\n  }\n}\n```\n\n- `@Get()`请求路径为`/cats`\n- `@Get('profile')`请求路径为`/cats/profile`\n\n## `Request`\n- `Nest`使用库（默认为`Express`）特有的请求对象\n- 因此，我们可以强制`Nest`使用`@Req()`装饰器将请求对象注入处理程序\n\n```ts\nimport { Controller, Get, Req } from '@nestjs/common';\nimport { Request } from 'express';\n\n@Controller('cats')\nexport class CatsController {\n  @Get()\n  findAll(@Req() request: Request): string {\n    return 'This action returns all cats';\n  }\n}\n\n```\n\n|装饰器|普通对象|\n|--|--|\n|@Request()\t|req|\n|@Response() @Res()*\t|res|\n|@Next()\t|next|\n|@Session()\t|req.session|\n|@Param(key?: string)\t|req.params / req.params[key]|\n|@Body(key?: string)\t|req.body / req.body[key]|\n|@Query(key?: string)\t|req.query / req.query[key]|\n|@Headers(name?: string)\t|req.headers / |req.headers[name]\n|@Ip()\t|req.ip|\n\n## 资源\n> 创建资源，`POST`处理程序\n\n```ts\nimport { Controller, Get, Post } from '@nestjs/common';\n\n@Controller('cats')\nexport class CatsController {\n  @Post()\n  create(): string {\n    return 'This action adds a new cat';\n  }\n\n  @Get()\n  findAll(): string {\n    return 'This action returns all cats';\n  }\n}\n```\n\n- `@Put()`、`@Delete()`、`@Patch()`、`@Options()`、 `@Head()`和`@All()`\n\n## 通配符\n- `Get('ab*cd')` // 正则表达式对应项的子集\n- `?` (0, 1)\n- `*` [0, +~]\n- `+` [1, +~]\n\n## 状态码\n> 使用装饰器修改状态码\n- `@HttpCode(204)`\n\n## Headers\n> 要指定自定义响应头，可以使用`@header()`修饰器或类库特有的响应对象,（使用并`res.header()`直接调用）\n\n```ts\n@Post()\n@Header('Cache-Control', 'none')\ncreate() {\n  return 'This action adds a new cat';\n}\n```\n\n## 重定向\n- 要将响应重定向到特定的`URL`\n- `@Redirect(url, statusCode)`\n  - `url`: 重定向路径\n  - `statusCode`: 默认为`301`\n\n```ts\n@Get('docs')\n@Redirect('https://docs.nestjs.com', 302)\ngetDocs(@Query('version') version) {\n  if (version && version === '5') {\n    return { url: 'https://docs.nestjs.com/v5/' };\n  }\n}\n```\n\n## 路由参数\n```ts\n// '/cats/1' 获取id 为 1\n@Get(':id') \nfindOne(@Param() params): string {\n  console.log(params.id);\n  return `This action returns a #${params.id} cat`;\n}\n\n@Get(':id')\nfindOne(@Param('id') id): string {\n  return `This action returns a #${id} cat`;\n}\n```\n\n## 子域路由\n- `@Controller` 装饰器可以接受一个 `host` 选项，以要求传入请求的 `HTTP` 主机匹配某个特定值。\n\n```ts\n@Controller({ host: 'admin.example.com' })\nexport class AdminController {\n  @Get()\n  index(): string {\n    return 'Admin page';\n  }\n}\n```\n\n## `Async / await`\n\n```ts\n@Get()\nasync findAll(): Promise<any[]> {\n  return [];\n}\n```\n\n### `Rxjs`\n\n```ts\n@Get()\nfindAll(): Observable<any[]> {\n  return of([]);\n}\n```\n\n### 请求负载\n- 确定`DTO`（数据传输对象）模式\n- 使用`TS`的接口或类来实现\n  - 推荐使用类（`ts`接口在转换过程中实体被删除） \n\n```ts\n// create-cat.dto.ts\n\nexport class CreateCatDto {\n  readonly name: string;\n  readonly age: number;\n  readonly breed: string;\n}\n```\n\n```ts\n// cats.controller.ts\n\n@post()\nasync create(@Body() createCatDto: CreateCatDto) {\n\treturn 'This action adds a new cat'\n}\n```","tags":[],"folderPathname":"/end/nest","data":{},"createdAt":"2020-11-25T08:00:25.949Z","updatedAt":"2020-11-25T09:27:59.340Z","trashed":true,"_id":"note:kuw2-q0JL","_rev":"98-4f576d176ab8dc55654e015ab5b82226"}