{"_id":"note:Ol40jYnqX","title":"概念","content":"## BFF层\n> 为前端而存在的后端(服务)中间层，前端走向云端，划分职责边界，提升协作效率\n\n![](image-krd3xzi0.png)\n### 作用\n> 处理前端技术接口请求→调用后端接口，进行数据聚合→响应前端，渲染页面\n\n用户体验适配层和 API 聚合层\n\n- 接口聚合和透传\n  - 服务于不同的端（app/小程序/web）\n  - 字段裁剪\n  - 接口合并调用\n  - 接口数据格式化\n- 缓存聚合调用的结果\n- 提供第三方使用的API\n- 服务自治（谁开发谁使用），减少协调成本\n\n### 适用场景\n> 要满足一定的场景并且基建很完善的情况下才使用，否则只会增加项目维护成本和风险，收益却非常小\n\n- 后端有稳定的领域服务，需要聚合层\n- 需求变化频繁，接口经常需要变动：后端有一套稳定的领域服务为多个项目服务，变动的话成本较高，而bff层针对单一的项目，在bff层变动可以实现最小成本的改动。\n- 有完善的基建：日志，链路，服务器监控，性能监控等（必备条件）\n\n### 探索方向\n- 稳定性：保障BFF的可靠性，如通过日志、错误分析、监控、报警等手段\n- 同构：让BFF与前端体验使用相同的技术栈，如基于Node的同构方案\n- 一体化：一方面针对下游服务提供mock方案，另一方面允许同构、非同构应用共存\n\n### Node.js能胜任吗\n#### 应用分布\n- 函数模型 70% （BFF属于这类）\n  - 快速开发、领域模型到UI模型的转换\n- 全站应用 20%\n  - 应用型应用（如语雀）\n- Task 异步任务 10%\n  - 覆盖高CPU/MEM、执行周期长（如构建任务、爬虫）\n\n#### 结论\n- Node.js 是完备的，足够胜任 BFF 的主要应用场景\n- BFF 要求服务自治，但不限制技术选型\n  - 选择生态最活跃，最能被前端接受的 Node.js\n- 我们缺的是沉淀\n  - 基础设施的建设和完善\n  - 最佳实践的沉淀和积累\n  - 人员平均水平的提升\n\n### 沉淀\n- 框架\n- 中间件，融入后端生态\n  - 分布式配置\n  - 缓存\n  - 限流\n  - 熔断\n- 平台能力\n  - 问题定位\n  - 包管理\n  - 研发管控平台\n  - 应用治理\n- BaaS 服务\n  - 常用能力下沉（如：渲染服务、消息服务、文件服务、构建服务）\n\n### 问题\n- 学习成本\n  - 额外的服务端、运维相关知识的学习成本\n- 治理成本\n  - 依赖升级，锁版本，中间件服务跨语言 SDK 的维护\n- 招人难\n  - 前端涉及领域多，人员储备不够，培养成本高\n- 资源利用率\n  - BFF 通常的水位较低（<30%）\n\n### CAS\n> CAS是Central Authentication Service的首字母缩写，Apereo CAS 是由耶鲁大学实验室2002年出的一个开源的统一认证服务。旨在为 Web 应用系统提供一种可靠的单点登录解决方法。\n\n![](https://upload-images.jianshu.io/upload_images/5718792-7935831ed658db61.png?imageMogr2/auto-orient/strip|imageView2/2/w/585/format/webp)\n\n1. 用户输入http://192.168.5.21:40888/ get访问网站\n2. 系统在收到该请求的时候并没有发现请求中带有`JSESSIONID`字段, 因此app系统判断发送该请求的用户没有登录认证，最后app系统做出的操作是，重定向该请求，让用户去访问SSO系统\n- JSESSIONID: 第一次访问服务器的时候，会在响应头里面看到Set-Cookie信息（只有在首次访问服务器的时候才会在响应头中出现该信息）\n\n![](image-ksichwij.png)\n```js\nhttps://192.168.5.21:40100/uums-cas/login?service=http://192.168.5.21:12323/uums-web/api/bus/administrators/getCurrentUser?timestamp=1629342487792&projectFrontUrl=http://192.168.5.21:40888/#/app\n```\n![](image-ksicig5p.png)\n![](image-ksicilu7.png)\n![](image-ksicjyje.png)\n\n```\nusername: Sadministrator\npassword: 5411f633fc3650436e8662b6d7f37c27\nexecution: e1f428de-dc78-408a-aed2-e8639896eb9d_ZXlKaGJHY2lPaUpJVXpVeE1pSjkucTVxTWkrOG1NaTNzWnlBRjRQVDIzaXlHdlV0bUVVV1pBSnFRQ3VHY0NSVjhibW02RDl1bmFPQjFxczhWZHlLdE8rVnZVTVdhQjhCN1Mza0lSTEtwa08yVTJJcVI1OFc2L0tuaUU1MzRkQk96MEp3ZXZ6OFozUW12a1BVTDMyV1BjcUplekNETm5yckdKVmsrV0M3ekYrTnMya1Y5Z0ZDWG44bmZTMG8wU21Vc2UyUUpLbFFNbHF5eFRVZzdMTlZBTHdTMmN1azVFZG1NOElSbEZ2QzVXdmgvZkM0WkZsQ0VZZkdTTndyL0o3bUM5T2I5c0FXMGZHd2FSOE1oa1ZrRTlweFZZMnFZUVAyNjU4THVWNGxRQkxPekZXRXFvWGVYNXV1cU1lYkZKQWNyZVB4dDM5cUdXd3Y1NEZyWFNydHM0aHd5ZEUrUlNTdGJlS2ZnVGNpSWUyWGtXT01LZ2Q4RlQxMnloYmxManorWXFXM2ZIMVJSTjhpVVNRS0s3bmJuSGNveW1zUTE2eGhLdFlqUkhWTXloV084eFh6b2RhcjhobnlYNHZMeWEwSGNsemxSRVBGaHV0cmptR3RFRUd0WGFSMGhPK0ZsRHVOZElQR1NONjVYeFVEbUNFMzZUekJJMjhXVHFla09pZFNjMm5LTXZjNlVnelUxT3AvaytodFVpSDAxejk3LzRUSU5XUEtkNGZON3NUcC9OL056aXI5bmlyRnd2YXp4bkw4dUE4SXl2Yk9SWURxdEVRekVOSmc5MmdoaHJQaWxIWkdYK0Z5VUN3WENHQVZPc0lhbTdPNWNSRDRKMXM4bmp4VTlZeTA5QjBuVzNFUStUenBXMlRBM3V2bVltKzg1dGNmejBabDRRbFJhWUUxQ2VORXpZWEY2QU0va2c4bzdIRU41dEgxTmFzeFJuUzJMckR6Qzd0Mm1qSzhObzM5V05vWG9tWVhMRWJJeDBodlFlZXRQVzE4ejBSOXhvelRzQ1dyTUtCcW83Z1kyZzZYN2toSnZ3VUxnWUV5cXIwSTF4MU91dXR5eWcwdHd3aDVEUEI0NyszYkw1WGZDeXFJYjZua0ZWbDRDR2paWE1BWEJuNlVteTBUWWZJQzNRdFNpU3FYZWJ5OGhpeDF4UlNsOFVhL0hjOThzNnk2YTNWdUk0U29kaUFYbUNoY2MxWGZCelcwOWcrcHVudFdPU1h1VWRZVXZNTHpIVS9TcnZNMUUwVmh6bkVxZ3FTWmR1RGhFRHg3b2dEZlp5RlBiMjFBdnU4L0FhS2dIaCtLWlFBMDRaQWdEbnZQZHAxVmpYbUZLMGtXNlIrTWZoVHlRWGxvRFpjamVWeVBIdk81MHowYVlrajRpUEpxSm45OUwzTVh4dXI5Wis3MCtacnB6bFgwTjZlelFLYnc4em0yTEo1OEhQSFZWOXJieGpwSG91RnFxTUFoNHFRdnpkNjFmYTRQYzVLT3h5bUozWjh6eFJmQlIxK1JvaXJEUllmcExtNTU0QzFXYzNqc29QWjdpNTRjVEJJbnlsMlhZU0dSb2V6TkZmc0JEcWFOaEtQSVlwM3pjdzJHY1lwcEoyckxqRmdjd0hNenZ6RUQ4ZjN1N2NCR1FYVGU0S3Y2Sk1QcTUxVXZMK1lSU3F2MFNFYlR3NkVmdXM3a1FzOEVTbHJOU1NQRFFXdTYyMVB0Y0pFaW03RmpEZGdVaTN6MUptRUhjcVlPNC96TlFORnpvRGtNWG10VTA0dUQvTHQrTGJ5YzA4dW1UYVg3bnZaMlZlTFZjSTVxd2IvNkV0OEpXVngvYXl1cGJrcTVuNHZTZ3BYZ0hwUTdRZ043eTBLQVFYQ0dVY0l6TnoyUjZBRHRHV25zUnFuck5tSkhtNXlVMU1lN3hTZFY3RVRJMGc0c1NqZ3A5TmVYNUZteWFqL0dJdUtNZ1JxWDNsQmZkRG1panNlQmtCM1k4eHFEdVRmNnA5TlVTWGg0RS9oMkhHUXA4R0oxQXFwT0xXNnhRYnRFbkYzbTBKRUNMUzZtUnJJYjBYZ2JYUEtvVnVQNHkraG1lb2IzVnJ2NXNvMFFxRnFYNXllVENOYnN6Z0lud21mcFh1c2dCWkIwV2MxbTFiQTcrK0hCejZoVS9XMDBhUnpXRm5nckwvL2FneHVvek83Vlh5clVQZTZHVkVDRnU2TzRtQ3I5YVhEaFIzQ3E3cnROWURVQXpndFk1ais4bnc5OW9zVlRJM0l6a1V6MTNBdXM5ZnJ4REdpWnVHWVFxZWgwanc0cmJxN0tzNzhrQWkzZmFHZUVnbXZHdEd2M1hoMEtDQnp0R3p2bWlXRFc4UXdmcVlYaDdsT1JrN0kwWjliOFM4dWJyejZodjlYYi9MaXE0TURmeG5zR2xNM2R5QThyaXd5NlA5OEt5akNDZUIwRVY4ZVcxVmxTdDJMdmcxQUV1WndqamdnMjlvTUs3SDg2K2R6YUxlOHJpbVllUzRDMVVacmx1ZjU3NFJlMm5nc2c3SjMvQ0lncmJYZUROY2tsSjl5dXFiT1FXRjZLQTlCSGkrZnRNTlZ3ZWtQVnF4b3lzWHVTWDNKSXVxTnY1ZVpXY1REVGVSaHY4QnlrdzhpUThRMVU4Mk42YWhvd2l5Znp2M1R6cTZoU3RuVzN4dC9mTUUrZENJdUpRcEYzbXdvUnc2Unhsc1VINjM0djJLQmREcFA3Z2wvcVVYMWVLQU5vbHN4Ylk5MUZLMUIxcjgxU0gvR0YrQnVMRDUvQWszVnFJYlRRUkU3blZaVnl5VjVDODFoYkV5b250K1ZZdzZoU2pjb1p1N0E1REJSQ2tIUG1NUC9SbUJPNEhkbU1RK1hLcVpCSG91b0x4eHlpNnYxazUvdURvdkxiUWR1NGdWd3Z2L1BRRXVZUjdXNFlUYU5sNnVXb1E3OGZoVXpDbzZMdFlTdXEvTUpVa2h0UkxnclIwUDFWdDFXeUZxaEpSREhMTGlVSlE4UGRQMzJqNUU1V3R2ZVgrdDlJSXpWYithakpoN2ttVnc0dWd5SWxDcTYrODQ3OWNGZDFWNkJXNzlDaXB2QUtuVkRjYTRoVEEwbmRLamRQVi9qaVNsTEowbW95aUsrWU5LTWNUZ29xZW93L3lpWUl3VjRZd0s5T2c2WXRSUEhSbG5SbWRIaVVmRVIzRm5EWjB0UWltdmphVGxmVVp6cUo5TzZlbDBPVmFUcU11TjU4VzVqYm50YVJ2WkR6ekt3RG5FL3pvd3A4U2IzK0R2T0hlNmlzZ0ExUU1FRGdLN3dpMThkMVJnR2I5SG9IelA0Tit6Rk1rVHdVNUdmUkI1ZVNjMERTbE1HcWVMK0xrWlIraW5hZXVoRVZYT3U2SEhySHIweEpYQkxDNG4wMUptc3ZsUE5MVGRjVXlIMHlSNDl0bFYxNng5aTh1dFBXcVlhbEtRS2ZFTE9zdFRDUVRzU1RsUE5pWmNaVlRzaFFLN0loMUJXUnpYaXhVbjNSRWhINXhiWE1mdml0cFcwa1NXbTJSU2ZoSFF6VE5VSHNnNVZnRXJmUEJKY1UyRVB6cVlMMDN4N1FoSm40Z1hpa1pDSGNOL2RKTk15UGpqNGVFemV4THhua2FtckdMN21QUGwrNmJNcFhsZ1hMOUsrb2xaazZWQTN4M0VUdm5GaGttWW5ScXNJRW9kZzdJR3dFVGtwU1hlYzRYMWdrR1QxNzg0YzhqdnFGYXFqU2ZhL0FScHFieURGUWdBdmZDd0JpK2hHajcyb2IxYno5aHVYcnBpWHNzZC9vRDl3eG9LcWZ0ekVySUZIVUc4LzZtTXNCUGV4QzFVOHp0NGVPS2RmMFg1UWlTWlVJcjQ4NFpJS2kwWDVLRFdTRmZ3ZDBKZ3lYSnpvdktraStwSEhMS1h5bGFQeU5STU9SRDVOUm1wcE5YU1I3dHQ1bTJTdG1nZG83c2x0T3ZxNUNLN2lMdU5aSVhLWmRxcjNUY042RHBXMERrRFUxbVdhdytqbktoME5QcG5MN05RSktGV0JNZHZrSGZJRTBvbFZ2enorRC9aS0YwdHI0aDhYQ1JOcnI3cGNOajB5RUtPRzExeFlBRFpVNEtFWVBHbFdJQnlJU2k5ZktUa1ptenp0UTVBanN3aWhlQlZ3SkdWK0tGWC9xa3o5Mi83c3dBTUZTVHNoQXZubDY2T2hYa0tEZjJ3N3JwOThlbkdTeHpmMlRkMk92ZlNwYmtWaW0zaVZpUU5NSXo2MmRkZGxlRlljZDhoeUNMN0R3QmxyMnBKVjZnem5HNzZtNVkwMlpIdEErWm5TVnlXazhRelpxcTVpZEtEZUQvN1hoZ0dvYS9XWWNxWjZ1Mm41MVV1YVpIWk94dHZnVkM0bjIvMTRNRHBtZ1VIVXhxOWdoeFhpM3VZc1VLb0hOdFlFeDdpTVk1Tm9XRjI0NVJVS3BXMVFSL0F1MklKampucHFNSTZGRlNxT3dHM3RnczNvRnJ4ckl4ZlFjMGFWOVhOdlNuMi9CUVpSZFduL3g3WEdGR0QrRFVHR3JuK1V3Z1Rtck4wdUs0R3I4Y25CRlc3V1pXZU1QamcyNUhQMDR6MEo3MHpiSzBQSEU2cWV2d1h1dUdtSlJjdkJtNEt6QVAvVUFULktuTTBYQTMxcC1uVVBqUVcxMHFaelFpT2c3VTJRQ2dVQ0J5VFdXRjkzRkVYeG5jUjkyV3M2TmlCMFdvWk9XNXA4aWM4R0cxdlpRNThMWkpIUm5rLXRR\n_eventId: submit\ngeolocation: \n```\n\n![](image-ksicncm2.png)\n![](image-ksicnrbt.png)\n\n![](image-ksicowl0.png)\n![](image-ksicp374.png)","tags":[],"folderPathname":"/end/bff","data":{},"createdAt":"2021-07-21T03:18:56.372Z","updatedAt":"2021-08-19T03:54:37.693Z","trashed":false,"_rev":"yGxZu-LQk"}