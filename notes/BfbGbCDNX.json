{"_id":"note:BfbGbCDNX","title":"theme","content":"## Theme方案\n### 选型\n#### 1. less modifyVars（不推荐）\n> 动态修改 less\n\n- 优势：可以选择任意颜色\n- 劣势：css无法压缩混淆\n\n#### 2. 改造 webpack插件 style-resource-loader\n> 存在技术细节未实现\n\n```json\n{\n    loader: require.resolve('style-resources-loader'),\n    options: { \n      patterns: {\n        default: [\n          'src/css/antd-theme/variable.less',\n          'src/css/variable.less'\n        ],\n        dark: [\n          'src/css/antd-theme/variable-dark.less',\n          'src/css/variable.less'\n        ],\n      }, \n      injector: 'append' \n    },\n},\n```\n\n```less\n// variable\n@text-color: #000;\n```\n\n```less\n// variable-dark\n@text-color: #fff;\n```\n\n```less\n// 生成\np {\n  color: @text-color\n}\n\n.dark {\n  p {\n    color: @text-color\n  }\n}\n```\n\n### 3. css变量 + antd-theme-webpack-plugin/antd-theme-generator\n> 验证中\n\n- [npm trend](https://www.npmtrends.com/antd-theme-generator-vs-antd-theme-webpack-plugin)\n- [antd-theme-webpack-plugin](https://github.com/mzohaibqc/antd-theme-webpack-plugin/blob/master/README.md)\n### 4. context + styled-components\n> 自带提供theme方案\n\n- 优势：可以使用ts，用来封装标准组件方便，不存在兼容性问题\n- 劣势：对antd的组件，需要二次封装\n![](image-kqvqkz01.png)\n```tsx\n// app.tsx\nimport { ThemeContext, themes } from 'framework/theme-context'\nimport { ThemeProvider } from 'styled-components'\n\nconst App: FC = () => {\n  const [theme, setTheme] = useState<'dark' | 'light'>('dark')\n  return (\n    <>\n      <ConfigProvider locale={zhCN}>\n        <ThemeContext.Provider\n          value={{\n            name: theme,\n            toggleTheme: (v: string) => {\n              setTheme(v === 'dark' ? 'light' : 'dark')\n              return v === 'dark' ? 'light' : 'dark'\n            },\n          }}\n        >\n          <ThemeProvider theme={{ ...themes[theme] }}>\n            <Router history={history}>\n              <Main />\n            </Router>\n          </ThemeProvider>\n        </ThemeContext.Provider>\n        <Loading />\n      </ConfigProvider>\n    </>\n  )\n}\nexport default App\n\n\n// components.tsx\nimport Text from '@/components/text'\nimport { ThemeContext } from '@/framework/theme-context'\nimport { Switch } from 'antd'\nimport React, { FC } from 'react'\n\nconst ThemeSwitch: FC = () => (\n  <>\n    <ThemeContext.Consumer>\n      {({ name, toggleTheme }) => (\n        <>\n          <Switch\n            onChange={() => {\n              toggleTheme(name)\n            }}\n          />\n          {name}\n        </>\n      )}\n    </ThemeContext.Consumer>\n    <section>\n      <Text />\n    </section>\n  </>\n)\n\nexport default ThemeSwitch\n```\n```ts\nimport base from './base'\nconst dark = {\n  ...base,\n  'text-import-color': '#fff',\n  'text-normal-color': 'rgba(255, 255, 255 0.8)',\n  'text-light-color': 'rgba(255, 255, 255 0.6)',\n}\nexport type Type = keyof (typeof dark)\nexport default dark\n\n```\n\n```tsx\n// text demo\ntype ITextStyle = ITextItem & {\n  theme: any // 未确定好\n}\n\ntype IType = 'success' | 'warn' | 'error' | 'primary' | 'default'\ntype ISize = 'lg' | 'md' | 'xs'\ntype IStatus = 'important' | 'normal' | 'light'\n\ninterface ITextItem {\n  status: IStatus\n  type: IType\n  size: ISize\n}\n\ntype IText = Partial<ITextItem> & {\n  className?: string\n  style?: React.CSSProperties\n}\n\nconst TextItem = styled.span`\n  ${(props: ITextStyle) => `\n    color: ${\n      props.type !== 'default'\n        ? props.theme[`text-${props.type}-color`]\n        : props.theme[`text-${props.status}-color`]\n    };\n    font-size: ${props.theme[`text-${props.size}-size`]}\n  `};\n`\nconst Text: FC<IText> = ({\n  status = 'normal',\n  size = 'md',\n  style = {},\n  className = '',\n  type = 'default',\n}) => (\n  <TextItem\n    type={type}\n    status={status}\n    size={size}\n    style={style}\n    className={className}\n  >\n    sss\n  </TextItem>\n)\n```\n","tags":[],"folderPathname":"/font/css","data":{},"createdAt":"2021-07-09T01:42:12.544Z","updatedAt":"2021-08-11T02:42:27.664Z","trashed":false,"_rev":"l7V0u5lCS"}