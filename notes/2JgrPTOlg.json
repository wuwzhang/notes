{"_id":"note:2JgrPTOlg","title":"service-worker","content":"## service-worker\n\n### 什么是`service worker`\n`Service Worker`是浏览器在后台独立于网页运行的脚本，它打开了通向不需要网页或用户交互的功能的大门。 \n\n现在，它们已包括如推送通知和后台同步等功能。 将来，`Service Worker`将会支持如定期同步或地理围栏等其他功能。 \n\n这个`API`之所以令人兴奋，是因为它可以支持离线体验，让开发者能够全面控制这一体验。\n\n在`Service Worker`出现前，存在能够在网络上为用户提供离线体验的另一个 `API`，称为[`AppCache`](https://www.html5rocks.com/en/tutorials/appcache/beginner/)。 `AppCache API`存在的许多相关问题，在设计 `Service Worker`时已予以避免。\n\n#### `service worker`注意事项\n- 它是一种`JavaScript Worker`，无法直接访问`DOM`。 `Service Worker` 通过响应`postMessage`接口发送的消息来与其控制的页面通信，页面可在必要时对`DOM`执行操作。\n- `Service Worker`是一种可编程网络代理，让您能够控制页面所发送网络请求的处理方式。\n- `Service Worker`在不用时会被中止，并在下次有需要时重启，因此，您不能依赖`Service Worker onfetch`和`onmessage`处理程序中的全局状态。 如果存在您需要持续保存并在重启后加以重用的信息，`Service Worker`可以访问 `IndexedDB API`。\n- `Service Worker`广泛地利用了`promise`。\n\n#### `service worker`生命周期\n`Service Worker`的生命周期完全独立于网页。\n\n要为网站安装服务工作线程，您需要先在页面的`JavaScript`中注册。 注册服务工作线程将会导致浏览器在后台启动服务工作线程安装步骤。\n\n在安装过程中，您通常需要缓存某些静态资产。 如果所有文件均已成功缓存，那么 `Service Worker`就安装完毕。 如果任何文件下载失败或缓存失败，那么安装步骤将会失败，`Service Worker`就无法激活（也就是说， 不会安装）。 如果发生这种情况，不必担心，它下次会再试一次。 但这意味着，如果安装完成，您可以知道您已在缓存中获得那些静态资产。\n\n安装之后，接下来就是激活步骤，这是管理旧缓存的绝佳机会，我们将在`Service Worker`的更新部分对此详加介绍。\n\n激活之后，`Service Worker`将会对其作用域内的所有页面实施控制，不过，首次注册该`Service Worker`的页面需要再次加载才会受其控制。 服务工作线程实施控制后，它将处于以下两种状态之一: 服务工作线程终止以节省内存，或处理获取和消息事件，从页面发出网络请求或消息后将会出现后一种状态。\n\n以下是`Service Worker`初始安装时的简化生命周期。\n\n![](https://developers.google.com/web/fundamentals/primers/service-workers/images/sw-lifecycle.png?hl=zh-cn)\n\n#### 先决条件\n- 浏览器\n  - `Service Worker`受`Chrome`、`Firefox`和`Opera`支持\n  - `Microsoft Edge`现在表示公开支持\n  - `Safari`也暗示未来会进行相关开发\n- HTTPS\n  - 在开发过程中，可以通过`localhost`使用`Service Worker`\n  - 在网站上部署`Service Worker`，则需要在服务器上设置`HTTPS`\n\n\n### 用`Service Worker`实现前端性能优化","tags":[],"folderPathname":"/font/pwa","data":{},"createdAt":"2021-03-30T02:29:10.336Z","updatedAt":"2021-03-30T02:29:22.747Z","trashed":false,"_rev":"6aVAYk9su"}