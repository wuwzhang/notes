{"title":"20210108","content":"## 2020/01/07\n\n## 每日资讯\n### 1. 为累觉不爱的`React`开发者提供的一些实用`hook`\n- `React Hook`除了可以保存状态外，还应该是响应式的以及可组合的。我们可以使用`Hook`来改造现有场景以提升效率。\n\n#### `useMounted`\n更新未挂载的`component`的状态，容易造成内存泄漏，如\n\n```js\nconst Button = ({onClick, ...rest}) => {\n  const [loading, setLoading] = useState(false);\n  const onClicked = async () => {\n    setLoading(true);\n    await onClick();\n    setLoading(false);\n  }\n  return <button onClick={onClicked} {...rest}/>\n}\n```\n\n需要知道组件是否被挂载，如果组件被卸载，则需要跳过\n\n```jsx\n// hooks\n\nconst useMounted = () => {\n  const isMounted = useRef(false);\n\n  useEffect(() => {\n    isMounted.current = true;\n    return () => {\n      isMounted.current = false;\n    };\n  }, []);\n\n  return isMounted;\n  };\n```\n\n```jsx\n// demo\n\nconst Button = ({onClick, ...rest}) => {\n  const [loading, setLoading] = useState(false);\n  const isMounted = useMounted();\n  const onClicked = async (e) => {\n    setLoading(true);\n    await onClick(e);\n    isMounted.current && setLoading(false);\n  }\n  return <button onClick={onClicked} {...rest}/>\n}\n```\n\n#### `useLoading`\n```jsx\n\nimport { useState } from \"react\";\n\nconst useLoading = (action) => {\n  const [loading, setLoading] = useState(false);\n\n  const doAction = (...args) => {\n    setLoading(true);\n    return action(...args).finally(() => setLoading(false));\n  };\n\n  return [doAction, loading];\n};\n\nexport default useLoading;\n```\n\n```jsx\n// demo\nimport {asyncA, asyncB} from './api'\n\nconst ComponentWithLoading = () => {\n  const [doA, aLoading] = useLoading(asyncA);\n  const [doB, bLoading] = useLoading(asyncB);\n\n  useEffect(() => {\n    doA();\n    doB();\n  }, []);\n\n  if (aLoading || bLoading)\n    return null; // or some fallback component\n\n  return (\n    // ...your real component content\n  )\n}\n```\n\n#### `useWebSocket`\n\n当要用到实时通信（聊天、游戏等）的应用程序时，就需要`websocket`,他提供了全双工通信； 在处理`React`组件中，如果没有在卸载时关闭`websocket`，就会导致有多个重复的`websocket`\n\n\n```jsx\n// hooks\nconst useWebSocket = (url, protocols, onMessage, onError) => {\n  const ws = useRef(null);\n  useEffect(() => {\n    const socket = new WebSocket(url, protocols);\n    socket.onmessage = onMessage;\n    socket.onerror = onError;\n    ws.current = socket;\n    return () => {\n      ws.current.close();\n    };\n  }, []);\n\n  return ws;\n};\n```\n\n```jsx\n// demo\n\nconst ChatView = () = {\n  const wsRef = useWebSocket(\n    'wss://example.com/chat',\n    null,\n    (message) => alert(message),\n    () => alert('error!')\n  );\n\n\n  return (\n    <div>\n      <button onClick={() => wsRef.current?.send('Hello, World!\")}>Click Me!</button>\n    </div>\n  )\n}\n```\n\n#### 相关文章\n- [ahooks - ahooks 是一个 React Hooks 库，致力提供常用且高质量的 Hooks](https://ahooks.js.org/zh-CN/docs/getting-started)\n> 拥有丰富的`hooks`,良好的学习素材\n\n  - `Async`(useRequest)\n  - `Table`(useAntdTable\\useFusionTable)\n  - `UI`(useDrop & useDrag\\useVirtualList...)\n  - `SideEffect`(useDebounce\\useInterval\\useThrottle...)\n  - `LifeCycle`(useMount\\useDebounceEffect\\useUpdate...)\n  - `State`(useUrlState\\useCountDown\\useWebSocket...)\n  - `Dom`(useScroll\\useHover\\useKeyPress\\useSize)\n  - `Advanced`(useCreation\\useEventEmitter...)\n- [Top 10 React Hook libraries ](https://dev.to/bornfightcompany/top-10-react-hook-libraries-4065)\n### 2. 值得学习的全栈课程，使用了 React，GraphQL 以及 TypeScript \n- 这是一个非常棒的全栈视频教程，在短短 10 天内超过 10 万次播放，时长约 14 小时。\n- 有兴趣的可以看一下\n- https://www.youtube.com/watch?v=I6ypD7qv3Z8\n\n\n## 每日一问\n\n> 以下代码的运行结果是？\n\n```js\nconst user = {\n  name: 'wuw',\n  age: 25,\n  pet: {\n    type: 'dog',\n  }\n}\n\nObject.freeze(user)\n\nuser.pet.name = 'cat'\nuser.age = 18\n\nconsole.log([user.pet.name, user.age])\n```\n\n- $A$ &nbsp;&nbsp;['cat', 18]\n- $B$ &nbsp;&nbsp;['cat', 25]\n- $C$ &nbsp;&nbsp;['dog', 18]\n- $D$ &nbsp;&nbsp;['dog', 25]\n\n### 昨天的答案\n- $C$\n- `Array`的`sort`会原地排序并返还原数组，所以是否排序都返回`ture`, `a1`和`a2`地址不同，所以是否排序都返回`false`\n","tags":[],"folderPathname":"/weekly","data":{},"createdAt":"2021-01-07T10:37:32.287Z","updatedAt":"2021-01-08T01:20:32.716Z","trashed":true,"_id":"note:gYraK0zjq","_rev":"165-cfd000f2d5fca513c126fe02b8a61f10"}