{"_id":"note:YTN3tElWp","title":"物料","content":"### 目录结构\n```js\nmaterial-warehouse-service\n├── dist         // dist文件\n├── local        // JWT认证\n├── src              // TypeScript 代码\n│   ├── entity       // 存储实体（数据库模型）的位置\n│   │   \n│   ├── migration   \n│   ├── shared       // 公用模块\n│   │   ├── acl      // 权限控制\n│   │   ├── configs  // 公用配置\n│   │   ├── dots     // 公用dot\n│   │   ├── logger   // 日志处理\n│   │   ├── middlewares // 公用中间件\n│   │   ├── pips      // 公用管道\n│   │   ├── request-context\n│   │   ├── filters  // 公用过滤器，异常处理\n│   │   └── utils    // 工具函数\n│   ├── modules \n│   │   └── block    // 物料模块\n│   │       ├── dto      // dto层，控制输入输出查询校验\n│   │       ├── entities // 数据库实体\n│   │       ├── block-acl.service.ts\n│   │       ├── block.module.ts\n│   │       ├── block.controller.ts\n│   │       ├── block.repositiory.ts\n│   │       └── block.service.ts      \n│   ├── app.controller.ts  \n│   ├── app.modules.ts   \n│   └── main.ts     // 程序执行主文件\n├── .env             // 数据库、端口、JWT配置文件\n├── .prettierrc      // prettierrc文件 \n├── .gitignore       // gitignore文件\n├── .eslintrc.js     // eslintrc\n├── ormconfig.json   // ORM和数据库连接配置\n├── package.json     // node module 依赖\n├── README.md        // 简单的 readme 文件\n└── tsconfig.json    // TypeScript 编译选项\n```\n\n### 整体架构\n![](image-ks5qdq5f.png)\n\n### 服务层接口\n#### swagger\n- http://152.136.124.204:5057/swagger/#/\n\n### 数据库结构\n![](image-ks5o8luf.png)\n\n### 核心技术\n#### [Nest](https://docs.nestjs.com/)\nNest.js，底层封装Express，开箱即用，是是 Node.js 版的 Spring 框架\n- 基于TS的web框架，可以进行严格的类型定义\n- 自动生成Swagger文档\n- 目录结构清晰，代码可复用性强\n- 层层处理，一定程度上可以约束代码，比如何时使用中间件、何时需要使用guards守卫等\n- 项目结构、命令行与angular类似\n\n#### [typeorm](https://typeorm.biunav.com/zh/#%E5%AE%89%E8%A3%85)\n- JavaScript ORM 框架, 提供额外的特性开发任何使用数据库应用\n\n#### [class-validator](https://segmentfault.com/a/1190000025123187)\n- 自定义一个全局的validation pipe，结合class-validator来做参数校验\n### 功能点\n> 作为后端所需功能点能全覆盖\n\n - [x] *api 约束，接口包装\n   - [x] api.interceptor\n - [X] *权限认证（JWT）\n   - [x] local - strategy\n   - [x] jwt - strategy\n   - [x] refresh - strategy\n   - [x] role\n - [x] *输入输出校验\n   - [x] class-validator\n   - [x] class-transformer\n - [x] *异常处理\n   - [x] 自定义异常\n   - [x] all-exceptions.filter\n   - [x] timeout.terceptor\n - [X] *接口文档 - swagger\n   - [x] auth - headers\n   - [x] tags - 分类\n   - [x] schemas\n - [x] config配置\n   - [x] key\n - [ ] *文件处理\n   - [x] 普通文件上传\n   - [x] 多文件上传\n   - [ ] 流文件处理\n   - [x] 打包压缩\n   - [x] 下载\n - [ ] 队列\n - [ ] 定时任务\n - [ ] websocket\n - [ ] 模板渲染\n - [ ] cache\n - [ ] *部署\n - [ ] 监控\n   - [x] nest-status-monitor nestv7未更新，不可用\n - [ ] curd生成器\n - [ ] 微服务\n - [ ] 日志\n   - [x] 模块封装（控制台，requestId、timestamp、stack、url、ip、user）\n   - [ ] 可视化\n - [ ] 断点调试\n - [ ] 单元测试\n - [ ] 数据库\n   - [x] mysql\n     - [x] typeorm\n   - [ ] redis\n - [ ] 安全\n - [ ] README\n\n_打勾为已验证功能_\n\n### 部署\n#### 部署\n```bash\n\n```\n#### 数据库\n```bash\n# 访问\nmysql -u root --socket=/var/lib/mysql3307/mysql.sock --port=3307 -p\n```\n\n#### 文件包\n```bash\n# /usr/local/material-nest/dist\n# uploads为上传的文件\n```\n\n### 参考资料\n- [nest文档](https://docs.nestjs.cn/8/introduction)\n- [参考项目 - nestjs-starter-rest-api](https://github.com/monstar-lab-oss/nestjs-starter-rest-api)\n- [参考项目 - nestjs-bff](https://github.com/ablestack/nestjs-bff)\n\n```bash\n# nginx\n# 启动nginx用指定的配置\n$ nginx -c /usr/local/nginx/conf/nginx.conf\n$ ps aux | grep nginx\n# 启动\n$ sudo nginx\n# 重启\n$ sudo nginx -s reload\n```\n\n```sql\nINSERT INTO user (username,name,password,disabled,roles) VALUES (\"0700\" ,\"唐李梅\",\"123456\",0,'USER'), (\"4680\",\"张丽莎\",\"123456\",0,'USER'), (\"1345\",\"张可心\",\"123456\",0,'USER'), (\"2130\",\"张韶乾\",\"1234\n56\",0,'USER'), (\"0694\",\"李伟\",\"123456\",0,'USER'), (\"0254\",\"李国岩\",\"123456\",0,'USER'), (\"3273\",\"杨航\",\"123456\",0,'USER'), (\"06\n93\",\"江金红\",\"123456\",0,'USER'), (\"2119\",\"牛春玲\",\"123456\",0,'USER'), (\"0563\",\"王双艳\",\"123456\",0,'USER'), (\"1642\",\"王豪恒\",\"1\n23456\",0,'USER'), (\"4080\",\"秦超月\",\"123456\",0,'USER'), (\"4203\",\"蒋长丽\",\"123456\",0,'USER'), (\"2024\",\"赵祺\",\"123456\",0,'USER'),\n (\"0420\",\"郭孝席\",\"123456\",0,'USER'), (\"2282\",\"陈双月\",\"123456\",0,'USER'), (\"2278\",\"陈玖\",\"123456\",0,'USER,ADMIN'), (\"2456\",\"陈禹\",\"\n123456\",0,'USER'), (\"0435\",\"魏振宇\",\"123456\",0,'USER'),(\"1565\",\"魏龙\",\"123456\",0,\"USER\");\n```","tags":[],"folderPathname":"/ml-doc","data":{},"createdAt":"2021-07-28T05:48:45.322Z","updatedAt":"2021-08-16T09:05:46.407Z","trashed":false,"_rev":"gkw5WWeUs"}