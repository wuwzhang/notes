{"title":"文件读写fs","content":"## 文件读取\n\n### 同步\n- `readFileSync`\n\n```js\nvar fs = require('fs');\n\nvar data;\n\ntry {\n  data = fs.readFileSync('./hello.txt', 'utf-8')\n  console.log(data)\n} catch (e) {\n  console.log(err)\n}\n```\n\n### 异步\n- `readFile`\n\n```js\nvar fs = require('fs');\n\nvar data;\n\nfs.readFile('./hello.txt', 'utf-8', function(err, data) {\n  if (err) {\n    console.log(err)\n  }\n  console.log(data)\n})\n```\n\n### 大文件读取\n- `createReadStream`\n- macOS txt转utf-8\n  - `iconv -c -f GB2312 -t UTF-8 人渣反派自救系统.txt >> 人渣反派自救系统utf8.txt`\n\n```js\nvar fs = require('fs')\n\nvar readStream = fs.createReadStream('./人渣反派自救系统utf8.txt', 'utf-8')\n\nreadStream\n  .on('data', function(chunk) {\n    console.log('data: ' + chunk)\n  })\n  .on('error', function(err) {\n    console.log('err: ' + err.message)\n  })\n  .on('end', function() {\n    console.log('end ~~')\n  })\n  .on('close', function() {\n    console.log('close')\n  })\n```\n\n## 文件写入\n### 异步\n- 如果文件不存在，则创建文件；如果文件存在，则覆盖文件内容；\n\n```js\nfs.writeFile('./hello.txt', 'hello world', 'utf8', function(err){\n    if(err) throw err;\n    console.log('文件写入成功');\n});\n```\n\n### 同步\n```js\nvar fs = require('fs');\n\ntry{\n    fs.writeFileSync('./hello.txt', 'hello world', 'utf8');\n    console.log('文件写入成功');\n}catch(err){\n    throw err;\n}\n```\n\n### 异步\n```js\nfs.writeFile('./hello.txt', 'hello world', 'utf8', function(err){\n    if(err) throw err;\n    console.log('文件写入成功');\n});\n```\n\n### 文件流\n```js\nvar fs = require('fs');\nvar writeStream = fs.createWriteStream('./fileForWrite1.txt', 'utf8');\n\nwriteStream\n    .on('close', function(){  // 已经关闭，不会再有事件抛出\n        console.log('已经关闭');\n    });\n\nwriteStream.write('hello');\nwriteStream.write('\\nworld');\nwriteStream.end('');\n```\n\n## 底层的接口\n- fd: 写入文件句柄\n- buffer: 写入的内容\n- offset: 将buffer从offset位置开始，长度为length的内容\n- length: 写入的buffer的长度\n- position: 从打开文件的position处写入\n- callback: 参数为 (err, written, buffer)。written表示有xx字节的buffer被写入\n\n### 接口\n- `fs.write(fd, buffer, offset, length[, position], callback) `\n- `fs.write(fd, data[, position[, encoding]], callback) `\n- `fs.writeSync(fd, buffer, offset, length[, position])`\n- `fs.writeSync(fd, data[, position[, encoding]])`\n\n### 文件是否存在\n```js\nvar fs = require('fs');\n\nfs.access('./fileForRead.txt', function(err){\n    if(err) throw err;\n    console.log('fileForRead.txt存在');\n});\n```\n\n## 删除文件\n### 异步\n```js\nfs.unlink('./fileForWrite1.txt', function(err){\n  if(err) throw err;\n  console.log('文件删除成功');\n});\n```\n### 同步\n```js\nfs.unlinkSync('./fileForUnlink.txt');\n```\n\n## 创建文件夹\n- 如果目录已存在，会报错\n### 同步\n```js\ntry {\n  fs.mkdirSync('hello');\n  console.log('创建目录成功');\n} catch(e){\n  throw e;\n}\n```\n### 异步\n- 异步版本\n```js\nfs.access('./fileForRead.txt', function(err){\n    if(err) throw err;\n    console.log('fileForRead.txt存在');\n});\n```\n\n## 遍历文件夹\n### 同步\n- fs.readdirSync() 只能读一层文件夹\n```js\nvar fs = require('fs');\nvar path = require('path');\n\nvar getFilesInDir = function (dir) {\n\n  var results = [path.resolve(dir)];\n  var files = fs.readdirSync(dir, 'utf8');\n\n  files.forEach(function (file) {\n\n    file = path.resolve(dir, file);\n    var stats = fs.statSync(file);\n\n    if (stats.isFile()) {\n      // results.push(file);\n    } else if (stats.isDirectory()) {\n      results = results.concat(getFilesInDir(file));\n    }\n  });\n\n  return results;\n};\n\nvar files = getFilesInDir('./');\nconsole.log(files);\n```\n\n## 文件重命名\n### 异步\n```js\nvar fs = require('fs');\n\nfs.rename('./hello', './world', function(err){\n    if(err) throw err;\n    console.log('重命名成功');\n});\n```\n### 同步\n```js\nfs.renameSync(oldPath, newPath)\n```\n\n## 监听文件修改\n### `fs.watchFile()`\n- 轮询。每隔一段时间检查文件是否发生变化。所以在不同平台上表现基本是一致的\n```js\nvar fs = require('fs');\n\nvar options = {\n    persistent: true,  // 默认就是true\n    interval: 2000  // 多久检查一次\n};\n\n// curr, prev 是被监听文件的状态, fs.Stat实例\n// 可以通过 fs.unwatch() 移除监听\nfs.watchFile('./hello.txt', options, function(curr, prev){\n    console.log('修改时间为: ' + curr.mtime);\n});\n```\n\n### `fs.watch()`\n- 不靠谱","tags":[],"folderPathname":"/node","data":{},"createdAt":"2020-11-14T06:09:26.593Z","updatedAt":"2020-11-14T08:02:59.059Z","trashed":false,"_id":"note:QQ0VknCgr","_rev":"75-276c6a40c64b29c37107a1cc664de1b6"}