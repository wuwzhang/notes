{"title":"Puppeteer","content":"Puppeteer（小说爬取？？？）\n==\n\n> 今天上班有点空，就学了一下爬虫，刚好想起昨天看的电视剧，就把他的小说爬下来了\n\n### 选型\n- 前端没门槛\n- 基于`DevTools`，同时拥有`node`和`chrome`的能力\n\n### 实现\n> 先做了一个截屏的版本，感觉图片不太方便（`kindle`看起来费劲），就在在做了个简易的`txt`版本\n\n- 基于`puppeteer-examples`,快速上手\n```\ngit clone https://github.com/checkly/puppeteer-examples\ncd puppeteer-examples\nnpm i\nnode demo/novel\n```\n- 简单实现\n```js\n\nconst puppeteer = require('puppeteer')\nconst fs = require('fs')\ntry {\n  (async () => {\n    const browser = await puppeteer.launch()\n    const page = await browser.newPage()\n    await page.tracing.start({\n      path: 'trace.json',\n      categories: ['devtools.timeline']\n    })\n\n    const getPage = async (i) => {\n      return new Promise(async (resolve, reject) => {\n        await browser.newPage().then(async page => {\n          // await page.setViewport({\n          //   width: 1920,\n          //   height: 1080\n          // });\n          try {\n            await page.goto(`https://www.idejian.com/book/12263732/${i + 1}.html`)\n            // await page.screenshot({ path: `${i}.png`, fullPage: true }) 截屏版\n            text = await page.$$eval('.h5_mainbody', value => value.map(u => u.innerHTML))\n\n            resolve(\n              (text[1] || text[0])\n                .replace(//s+/g, '  ')\n                .replace(/[/n/r/t]/g, '')\n                .replace(/(&nbsp;|<//([^>]+)>)/ig, '/n')\n                .replace(/(<([^>]+)>)/ig, ''))\n          } catch (err) {\n            console.log('error' + i)\n          }\n\n          return 1\n        })\n      })\n    }\n\n    const ans = await Promise.all([...new Array(97).keys()].map((_, i) => getPage(i)))\n    const file = fs.createWriteStream('./传闻中的三公主.txt');\n    ans.map(v => file.write(v))\n    file.end();\n    await page.tracing.stop();\n    await browser.close()\n  })()\n} catch (err) {\n  console.error(err)\n}\n\n```","tags":[],"folderPathname":"/font","data":{},"createdAt":"2020-08-07T02:56:11.516Z","updatedAt":"2020-08-07T02:56:21.682Z","trashed":false,"_id":"note:7scjAgwaD","_rev":"3-8f95d13af51c17083188d7234ea0fa48"}